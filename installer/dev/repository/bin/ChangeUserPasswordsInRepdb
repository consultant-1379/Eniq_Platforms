#!/usr/sunos/bin/sh
# ----------------------------------------------------------------------
# Usage: ChangeUserPasswordsInRepdb USERNAME OLD_PASSWORD NEW_PASSWORD
#

DBUSER=$1
OLD_PASSWORD=$2
NEW_PASSWORD=$3

USAGE_STRING="ChangeUserPasswordsInRepdb USERNAME OLD_PASSWORD NEW_PASSWORD"

if [ -z "${DBUSER}" ] ; then
   echo ${USAGE_STRING}
   exit 10
fi

if [ -z "${OLD_PASSWORD}" ] ; then
   echo ${USAGE_STRING}
   exit 10
fi

if [ -z "${NEW_PASSWORD}" ] ; then
   echo ${USAGE_STRING}
   exit 10
fi

if [ -z "${CONF_DIR}" ] ; then
  echo "ERROR: CONF_DIR is not set"
  exit 1
fi

if [ ! -r "${CONF_DIR}/niq.rc" ] ; then
  echo "ERROR: Source file is not readable at ${CONF_DIR}/niq.rc"
  exit 2
fi

. ${CONF_DIR}/niq.rc

CPATH="${INSTALLER_DIR}/lib/installer.jar"

DIRS=`ls ${PLATFORM_DIR}`

for file in $DIRS
do
  if [ -d ${PLATFORM_DIR}/$file/dclib ]
  then
    JARS=`ls ${PLATFORM_DIR}/$file/dclib/*.jar`

    for jar in $JARS
    do
      CPATH="${CPATH}:${jar}"
    done
  fi
done

JAVA_HOME=${RT_DIR}/java
export JAVA_HOME

PATH=${RT_DIR}/java/bin:${PATH}
export PATH

${JAVA_HOME}/bin/java -d64 -Dpname="DBUsers" -DCONF_DIR=${CONF_DIR} -classpath ${CPATH} com.ericsson.eniq.repository.dbusers.UpdateDBPass ${DBUSER} ${OLD_PASSWORD} ${NEW_PASSWORD}
E=${?}
exit ${E}

