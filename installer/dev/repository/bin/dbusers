#!/usr/sunos/bin/sh
# ----------------------------------------------------------------------
# Usage: dbusers username
#

DBUSER=$1
CONNECTION=$2

if [ -z "${DBUSER}" ] ; then
   echo "Usage: dbusers username connection"
   exit 10
fi

if [ -z "${CONNECTION}" ] ; then
   echo "Usage: dbusers username connection"
   exit 10
fi

if [ -z "${CONF_DIR}" ] ; then
  echo "ERROR: CONF_DIR is not set"
  exit 1
fi

if [ ! -r "${CONF_DIR}/niq.rc" ] ; then
  echo "ERROR: Source file is not readable at ${CONF_DIR}/niq.rc"
  exit 2
fi

. ${CONF_DIR}/niq.rc

CPATH="${INSTALLER_DIR}/lib/installer.jar"

DIRS=`ls ${PLATFORM_DIR} | grep -v mediator-R*`

for file in $DIRS
do
  if [ -d ${PLATFORM_DIR}/$file/dclib ]
  then
    JARS=`ls ${PLATFORM_DIR}/$file/dclib/*.jar`

    for jar in $JARS
    do
      CPATH="${CPATH}:${jar}"
    done
  fi
done

# Check to see if OS is Linux, if so set a different JAVA_HOME directory
_os_=`uname`
if [ "${_os_}" = "Linux" ] ; then
        JAVA_HOME="/usr/java/latest"
else
        JAVA_HOME=${RT_DIR}/java
fi
export JAVA_HOME

PATH=${RT_DIR}/java/bin:${PATH}
export PATH

${JAVA_HOME}/bin/java -d64 -Dpname="DBUsers" -DCONF_DIR=${CONF_DIR} -classpath ${CPATH} com.ericsson.eniq.repository.dbusers.GetDBPass ${DBUSER} ${CONNECTION}
E=${?}
exit ${E}